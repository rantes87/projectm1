<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ProjectM | USA Interface</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root {
            /* USA Dark Theme Palette */
            --bg-dark: #0B0F19;       /* Deep Navy Black */
            --card-bg: #151B2B;       /* Lighter Navy */
            --paper-bg: #0f1420;      /* Distinct bg for whitepaper */
            --text-main: #FFFFFF;
            --text-muted: #94A3B8;
            --primary-blue: #3B82F6;  /* Liberty Blue */
            --primary-hover: #2563EB;
            --danger-red: #EF4444;    /* Old Glory Red */
            --danger-hover: #DC2626;
            --border: #1E293B;
            --success: #10B981;
        }

        html { scroll-behavior: smooth; }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 900px;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
            margin-top: 20px;
        }

        .brand {
            font-size: 28px;
            font-weight: 800;
            letter-spacing: -1px;
            background: linear-gradient(90deg, #FFFFFF, #94A3B8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-buttons {
            display: flex;
            gap: 10px;
        }

        /* Grid Layout */
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            .header-buttons { flex-direction: column; }
        }

        /* Cards */
        .card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3);
        }

        .card h2 {
            margin-top: 0;
            font-size: 18px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        /* Stats Rows */
        .stat-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .stat-value {
            font-weight: 700;
            font-family: 'Courier New', monospace;
            color: var(--primary-blue);
        }

        /* Buttons & Inputs */
        input {
            width: 100%;
            background: #0F172A;
            border: 1px solid var(--border);
            color: white;
            padding: 12px;
            border-radius: 6px;
            box-sizing: border-box;
            margin-bottom: 10px;
            font-family: inherit;
        }

        button {
            padding: 14px 20px;
            border-radius: 6px;
            font-weight: 700;
            text-transform: uppercase;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            font-size: 14px;
        }
        
        button.full-width { width: 100%; margin-bottom: 10px; }

        .btn-blue { background: var(--primary-blue); color: white; }
        .btn-blue:hover { background: var(--primary-hover); }

        .btn-red { background: var(--danger-red); color: white; }
        .btn-red:hover { background: var(--danger-hover); }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--text-muted);
        }
        .btn-outline:hover { border-color: var(--text-main); color: var(--text-main); }

        /* Status & Logs */
        .status-bar {
            background: #1e293b;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 13px;
            color: var(--success);
            text-align: center;
            min-height: 20px;
            margin-top: 20px;
        }
        
        .hidden { display: none; }

        /* WHITE PAPER SECTION STYLES */
        .white-paper-container {
            margin-top: 60px;
            padding-top: 40px;
            border-top: 1px solid var(--border);
            background-color: var(--paper-bg);
            width: 100%;
            display: flex;
            justify-content: center;
            padding-bottom: 80px;
        }

        .paper-content {
            max-width: 800px;
            padding: 0 20px;
            line-height: 1.8;
            color: #cbd5e1;
        }

        .paper-content h1 {
            color: white;
            font-size: 32px;
            margin-bottom: 10px;
            border-bottom: 2px solid var(--primary-blue);
            display: inline-block;
            padding-bottom: 5px;
        }

        .paper-content h2 {
            color: white;
            font-size: 24px;
            margin-top: 40px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 10px;
        }

        .paper-content h3 {
            color: var(--primary-blue);
            font-size: 18px;
            margin-top: 25px;
        }

        .paper-content p { margin-bottom: 15px; }

        /* Quick Start Box */
        .quick-start {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid var(--primary-blue);
            border-radius: 8px;
            padding: 25px;
            margin-top: 30px;
            margin-bottom: 40px;
        }
        .quick-start h2 {
            color: var(--primary-blue);
            margin-top: 0; 
            border: none;
            font-size: 20px;
        }
        .quick-start ul { padding-left: 20px; }
        .quick-start li { margin-bottom: 10px; color: #e2e8f0; }

        .math-box {
            background: #1e293b;
            padding: 15px 20px;
            border-left: 4px solid var(--primary-blue);
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            color: var(--primary-blue);
            font-weight: bold;
        }

        .highlight {
            color: var(--danger-red);
            font-weight: bold;
        }

        .meta-info {
            font-size: 14px;
            color: var(--text-muted);
            margin-bottom: 10px;
            font-family: monospace;
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="brand">
            PROJECT M <span style="font-size:12px; background:var(--danger-red); padding: 2px 6px; border-radius: 4px; color:white;">USA</span>
        </div>
        <div class="header-buttons">
            <button class="btn-outline" onclick="scrollToPaper()">Read White Paper</button>
            <button id="connectBtn" class="btn-blue" onclick="connectWallet()">Connect Wallet</button>
        </div>
    </header>

    <div class="grid">
        <div class="card">
            <h2>Global Stats</h2>
            <div class="stat-row"><span>Current Level</span> <span class="stat-value" id="g_level">-</span></div>
            <div class="stat-row"><span>Entry Price</span> <span class="stat-value" id="g_price">- ETH</span></div>
            <div class="stat-row"><span>Burn Price</span> <span class="stat-value" id="g_burnPrice">- ETH</span></div>
            <div class="stat-row"><span>Total Supply</span> <span class="stat-value" id="g_supply">- PMT</span></div>
            <div class="stat-row"><span>Contract ETH</span> <span class="stat-value" id="g_eth">- ETH</span></div>
        </div>

        <div class="card">
            <h2>My Stats</h2>
            <div class="stat-row"><span>My Level</span> <span class="stat-value" id="m_level">-</span></div>
            <div class="stat-row"><span>My Balance</span> <span class="stat-value" id="m_balance">- PMT</span></div>
            <div class="stat-row"><span>Mineable</span> <span class="stat-value" id="m_mineable">- PMT</span></div>
            <div class="stat-row"><span>Burn Value (Net)</span> <span class="stat-value" style="color:var(--success)" id="m_burnVal">- ETH</span></div>
        </div>
    </div>

    <div class="grid">
        <div class="card">
            <h2>Join & Mine</h2>
            <p style="color:var(--text-muted); font-size:13px; margin-bottom:15px;">Send ETH to join level or level up.</p>
            <div class="stat-row"><span>Required ETH:</span> <span class="stat-value" id="req_eth">-</span></div>
            <button class="btn-blue full-width" onclick="handleJoinMine()">Send ETH (Join/Mine)</button>
        </div>

        <div class="card" style="border-color: rgba(239, 68, 68, 0.3);">
            <h2 style="color: var(--danger-red); border-color: rgba(239, 68, 68, 0.3);">Burn Zone</h2>
            <p style="color:var(--text-muted); font-size:13px; margin-bottom:15px;">Burn PMT to exit with ETH.</p>
            
            <input type="text" id="burnAmount" placeholder="Amount to burn (e.g. 1.5)">
            <button class="btn-red full-width" onclick="burnTokens()">Burn Specific Amount</button>
            <button class="btn-outline full-width" style="color:var(--danger-red); border-color:var(--danger-red)" onclick="burnAll()">Burn Everything (Exit)</button>
        </div>
    </div>

    <div id="statusBox" class="status-bar hidden">Ready</div>
</div>

<div class="white-paper-container" id="whitepaper-section">
    <div class="paper-content">
        <h1>ProjectM White Paper</h1>
        <div class="meta-info">
            VERSION: 1.0.4-DIRECT-BURN | STATUS: LIVE & IMMUTABLE | ADMIN: NONE
        </div>

        <div class="quick-start">
            <h2>⚡ Quick Start Guide</h2>
            <ul>
                <li><strong>1. Connect:</strong> Link your MetaMask wallet using the button at the top right.</li>
                <li><strong>2. Join:</strong> Click the <strong>Send ETH (Join/Mine)</strong> button. This automatically calculates the cost, mints your PMT, and sets your level.</li>
                <li><strong>3. Mine:</strong> If the global level rises, click "Send ETH" again to catch up and mint new rewards.</li>
                <li><strong>4. Exit:</strong> Use the <strong>Burn Zone</strong> to destroy tokens and instantly withdraw your share of the ETH treasury.</li>
            </ul>
        </div>

        <h2>1. Abstract</h2>
        <p>ProjectM is a decentralized, autonomous economic experiment deployed on the Ethereum blockchain. It operates as a self-sustaining "Level Protocol" where the cost of entry and the value of participation are determined by algorithmic scarcity and collective participation.</p>
        <p>Unlike traditional DeFi tokens with arbitrary supplies or developer allocations, ProjectM has <strong>no administrator, no pre-mine, and no owner functions</strong>. It is an immutable smart contract where the liquidity is owned by the protocol itself.</p>

        <h2>2. Protocol Mechanics</h2>
        <p>The ProjectM economy is driven by a <strong>Global Level System</strong>. The state of the contract is defined by the current <code>contractLevel</code> (starting at 10).</p>

        <h3>2.1 Dynamic Pricing</h3>
        <p>The cost to enter the protocol is not fixed. It scales linearly with the Global Level. This creates a rising floor for entry, rewarding early participants while requiring higher capital commitment from later entrants.</p>
        <div class="math-box">Price = CurrentLevel × 0.002 ETH</div>
        <ul>
            <li><strong>Level 10 (Launch):</strong> 0.02 ETH</li>
            <li><strong>Level 50:</strong> 0.10 ETH</li>
            <li><strong>Level 100:</strong> 0.20 ETH</li>
        </ul>

        <h3>2.2 Joining & Mining</h3>
        <p>Users interact with the protocol by sending ETH directly to the contract:</p>
        <ul>
            <li><strong>New Users (Joining):</strong> If a user has 0 balance, they "Join." They pay the current level price and mint <strong>1.00 PMT</strong>.</li>
            <li><strong>Existing Users (Mining):</strong> If a user joined at a lower level and the Global Level has risen, they pay the current price to update their level. They mint new PMT tokens proportional to the levels skipped.</li>
        </ul>

        <h2>3. Tokenomics & The "Soap" Economy</h2>
        <p>The native token is <strong>PMT</strong> (ProjectM Token), colloquially referred to in the smart contract functions as "Soap."</p>

        <h3>3.1 The Value Backing (The "Burn")</h3>
        <p>Unlike tokens that rely on external market makers, PMT derives its value from the ETH held inside the contract reserves. Any user can "burn" their PMT at any time to withdraw their share of the treasury.</p>
        <div class="math-box">Gross Value = (User Balance × Contract ETH) / Total Supply</div>

        <h3>3.2 The Deflationary Tax</h3>
        <p>ProjectM implements a <span class="highlight">10% Exit Tax</span> on all burns. This is the primary value-accrual engine of the protocol.</p>
        <p>When a user burns PMT:</p>
        <ol>
            <li><strong>100%</strong> of their tokens are destroyed.</li>
            <li><strong>90%</strong> of the ETH value is sent to the user.</li>
            <li><strong>10%</strong> of the ETH value remains in the contract permanently.</li>
        </ol>
        <p><strong>Economic Implication:</strong> Because the ETH stays in the contract but the tokens representing a claim on that ETH are destroyed, the <strong>backing per remaining token increases mathematically</strong> with every exit.</p>

        <h2>4. Advanced Interactions</h2>
        <ul>
            <li><strong>Go Big:</strong> Sending excess ETH beyond the required price is treated as a direct donation to the liquidity reserve, instantly increasing the burn value for all holders.</li>
            <li><strong>Burn Trigger:</strong> Sending exactly <strong>69 gwei</strong> to the contract triggers a full exit (burn all), liquidating the user's position in a single transaction.</li>
        </ul>

        <h2>5. Conclusion</h2>
        <p>ProjectM is a financial game of coordination. It combines the mechanics of a bonding curve with a friction-based value capture system. It is a zero-dependency protocol that will exist as long as Ethereum exists.</p>
    </div>
</div>

<script>
    // --- CONFIGURATION ---
    const CONTRACT_ADDRESS = "YOUR_CONTRACT_ADDRESS_HERE"; // <--- PASTE ADDRESS HERE
    
    // Minimal ABI based on your Solidity code
    const ABI = [
        "function projectStats() public view returns (uint256, uint256, uint256, uint256, uint256, uint256, uint256, uint256)",
        "function playerStats(address) public view returns (uint256, uint256, uint256, uint256, uint256, uint256)",
        "function burnSoap(uint256 quantity) external",
        "function burnAllSoap() external",
        "function getCurrentPrice() public view returns (uint256)",
        "function decimals() view returns (uint8)"
    ];

    let provider, signer, contract;
    let userAddress = null;

    function scrollToPaper() {
        document.getElementById('whitepaper-section').scrollIntoView({ behavior: 'smooth' });
    }

    async function connectWallet() {
        if (!window.ethereum) return alert("Install MetaMask");
        
        try {
            provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            signer = provider.getSigner();
            userAddress = await signer.getAddress();
            contract = new ethers.Contract(CONTRACT_ADDRESS, ABI, signer);

            document.getElementById("connectBtn").innerText = userAddress.substring(0,6) + "..." + userAddress.substring(38);
            document.getElementById("connectBtn").classList.replace("btn-blue", "btn-outline");
            
            refreshData();
            // Auto refresh every 5 seconds
            setInterval(refreshData, 5000);
            
            showStatus("Wallet Connected");
        } catch (e) {
            console.error(e);
            showStatus("Connection Failed");
        }
    }

    async function refreshData() {
        if (!contract) return;

        try {
            // 1. Fetch Project Stats
            const pStats = await contract.projectStats();
            
            document.getElementById("g_level").innerText = pStats[0].toString();
            document.getElementById("g_price").innerText = ethers.utils.formatEther(pStats[1]);
            document.getElementById("g_burnPrice").innerText = ethers.utils.formatEther(pStats[2]);
            document.getElementById("g_supply").innerText = parseFloat(ethers.utils.formatEther(pStats[4])).toFixed(2);
            document.getElementById("g_eth").innerText = parseFloat(ethers.utils.formatEther(pStats[5])).toFixed(4);
            
            document.getElementById("req_eth").innerText = ethers.utils.formatEther(pStats[1]) + " ETH";

            // 2. Fetch Player Stats
            const mStats = await contract.playerStats(userAddress);

            document.getElementById("m_level").innerText = mStats[1].toString();
            document.getElementById("m_balance").innerText = parseFloat(ethers.utils.formatEther(mStats[0])).toFixed(2);
            document.getElementById("m_mineable").innerText = parseFloat(ethers.utils.formatEther(mStats[2])).toFixed(2);
            document.getElementById("m_burnVal").innerText = parseFloat(ethers.utils.formatEther(mStats[4])).toFixed(4) + " ETH";

        } catch (e) {
            console.error("Error fetching data", e);
        }
    }

    async function handleJoinMine() {
        if (!contract) return alert("Connect Wallet First");
        try {
            showStatus("Initiating Transaction...");
            const price = await contract.getCurrentPrice();
            
            const tx = await signer.sendTransaction({
                to: CONTRACT_ADDRESS,
                value: price
            });
            
            showStatus("Transaction Sent: " + tx.hash);
            await tx.wait();
            showStatus("Success! Transaction Confirmed.");
            refreshData();
        } catch (e) {
            showStatus("Error: " + (e.reason || e.message));
        }
    }

    async function burnTokens() {
        if (!contract) return alert("Connect Wallet First");
        const amount = document.getElementById("burnAmount").value;
        if (!amount) return alert("Enter amount");

        try {
            showStatus("Burning tokens...");
            const weiAmount = ethers.utils.parseEther(amount);
            const tx = await contract.burnSoap(weiAmount);
            
            showStatus("Burn Pending: " + tx.hash);
            await tx.wait();
            showStatus("Burn Confirmed!");
            refreshData();
        } catch (e) {
            showStatus("Error: " + (e.reason || e.message));
        }
    }

    async function burnAll() {
        if (!contract) return alert("Connect Wallet First");
        if (!confirm("Are you sure you want to burn ALL tokens and exit?")) return;

        try {
            showStatus("Burning ALL tokens...");
            const tx = await contract.burnAllSoap();
            
            showStatus("Burn Pending: " + tx.hash);
            await tx.wait();
            showStatus("All Tokens Burned!");
            refreshData();
        } catch (e) {
            showStatus("Error: " + (e.reason || e.message));
        }
    }

    function showStatus(msg) {
        const el = document.getElementById("statusBox");
        el.innerText = msg;
        el.classList.remove("hidden");
    }
</script>

</body>
</html>